{{- if or .Values.monitor.clusterPerformance.enabled .Values.monitor.container.prometheus.exporter.enabled .Values.kubernetes_monitor_cluster_prometheus_exporters_enabled .Values.kubernetes_monitor_node_container_prometheus_exporters_enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: caaiops-config-prometheus
  namespace: {{ .Release.Namespace }}

data:
  kubernetes_remote_monitoring_bundles_load: KubernetesRemoteMonitor
  default.properties: |
    prometheus.metric.sets: set1
    prometheus.metric.set1.metric_list:
    prometheus.metric.set1.apm_metric_path:
    prometheus.metric.set1.apm_metric_type: LongFluctuating
    prometheus.metric.set1.aggregation_type: sum
    additional.label.sets:
  cadvisor.properties: |
    prometheus.metric.sets:set1,set2
    prometheus.metric.set1.metric_list: container_cpu_usage_seconds_total,container_spec_cpu_quota,container_spec_cpu_period,container_cpu_usage_seconds_total,container_cpu_cfs_throttled_seconds_total,container_memory_working_set_bytes,container_memory_max_usage_bytes,container_memory_failcnt,container_fs_writes_bytes_total,container_fs_reads_bytes_total,container_network_receive_bytes_total,container_network_transmit_bytes_total,container_network_receive_packets_dropped_total,container_network_transmit_packets_dropped_total
    prometheus.metric.set1.apm_metric_path: {{ .Values.type }}|Namespaces|(aiops_namespace)|Pods|(aiops_pod)|Containers|(aiops_container), {{ .Values.type }}|Namespaces|(aiops_namespace)|Pods|(aiops_pod)
    prometheus.metric.set1.apm_metric_type: LongFluctuating
    prometheus.metric.set1.aggregation_type: sum
    prometheus.metric.set2.metric_list: container_spec_memory_limit_bytes
    prometheus.metric.set2.apm_metric_path: {{ .Values.type }}|Namespaces|(aiops_namespace)|Pods|(aiops_pod)|Containers|(aiops_container):container_memory_max_usage_bytes, {{ .Values.type }}|Namespaces|(aiops_namespace)|Pods|(aiops_pod):container_memory_max_usage_bytes
    prometheus.metric.set2.apm_metric_type: LongFluctuating
    prometheus.metric.set2.aggregation_type: sum
    additional.label.sets: set1, set2, set3, set4, set5, set6
    additional.label.set1.source_label: namespace
    additional.label.set1.target_label: aiops_namespace
    additional.label.set2.source_label: pod_name
    additional.label.set2.target_label: aiops_pod

    additional.label.set3.source_label: container_name
    additional.label.set3.target_label: aiops_container
    additional.label.set4.source_label: container_label_io_kubernetes_pod_namespace
    additional.label.set4.target_label: aiops_namespace
    additional.label.set5.source_label: container_label_io_kubernetes_pod_name
    additional.label.set5.target_label: aiops_pod
    additional.label.set6.source_label: container_label_io_kubernetes_container_name
    additional.label.set6.target_label: aiops_container


  node-exporter.properties: |
    prometheus.metric.sets: cpu,cpuload,memavailable,memtotal,diskreadwrite,filesystemfree,filesystemsize,network
    prometheus.metric.cpu.metric_list: node_cpu_seconds_total
    prometheus.metric.cpu.apm_metric_path: Prometheus|(node_name)|CPU:total_(aiops_mode)_node_cpu_seconds_total,Prometheus|(node_name)|CPU|Core(aiops_cpu):(aiops_mode)_node_cpu_seconds_total
    prometheus.metric.cpu.apm_metric_type:LongFluctuating
    prometheus.metric.cpu.aggregation_type:sum
    prometheus.metric.cpuload.metric_list:node_load1
    prometheus.metric.cpuload.apm_metric_path:Prometheus|(node_name)|CPU
    prometheus.metric.memavailable.metric_list:node_memory_MemAvailable_bytes, node_memory_MemAvailable
    prometheus.metric.memavailable.apm_metric_path:Prometheus|(node_name)|Memory:node_memory_MemAvailable_bytes
    prometheus.metric.memtotal.metric_list:node_memory_MemTotal_bytes,node_memory_MemTotal
    prometheus.metric.memtotal.apm_metric_path:Prometheus|(node_name)|Memory:node_memory_MemTotal_bytes
    prometheus.metric.diskreadwrite.metric_list:node_disk_written_bytes_total,node_disk_read_bytes_total
    prometheus.metric.diskreadwrite.apm_metric_path:Prometheus|(node_name)|Storage
    prometheus.metric.filesystemfree.metric_list:node_filesystem_free_bytes
    prometheus.metric.filesystemfree.apm_metric_path:Prometheus|(node_name)|Storage:(aiops_device)_node_filesystem_free_bytes, Prometheus|(node_name)|Storage|(aiops_device)|(mountpoint)
    prometheus.metric.filesystemsize.metric_list:node_filesystem_size_bytes
    prometheus.metric.filesystemsize.apm_metric_path:Prometheus|(node_name)|Storage:(aiops_device)_node_filesystem_size_bytes, Prometheus|(node_name)|Storage|(aiops_device)|(mountpoint)
    prometheus.metric.network.metric_list:node_network_receive_bytes_total, node_network_transmit_bytes_total, node_network_receive_drop_total, node_network_transmit_drop_total, node_network_transmit_errs_total, node_network_receive_errs_total
    prometheus.metric.network.apm_metric_path:Prometheus|(node_name)|Network, Prometheus|(node_name)|Network|(aiops_device)
    additional.label.sets:set1, set2, set3, set4
    additional.label.set1.source_label:device
    additional.label.set1.target_label:aiops_device
    additional.label.set2.source_label:cpu
    additional.label.set2.target_label:aiops_cpu
    additional.label.set3.source_label:mode
    additional.label.set3.target_label:aiops_mode
  kube-state-metric.properties: |
    prometheus.metric.sets=node_status,pod_status,unschedulable_node,container_status, container_waiting_reason,node_allocatable_capacity, daemonset1,daemonset2, deployments1, deployments2
    prometheus.metric.node_status.metric_list=kube_node_status_condition
    prometheus.metric.node_status.apm_metric_path={{ .Values.type }}|Nodes:kube_node_status_condition_(condition)_(status), {{ .Values.type }}|Nodes|(node):kube_node_status_condition_(condition)_(status)
    prometheus.metric.pod_status.metric_list=kube_pod_status_phase
    prometheus.metric.pod_status.apm_metric_path={{ .Values.type }}|Namespaces:kube_pod_status_phase_(phase), {{ .Values.type }}|Namespaces|(namespace):kube_pod_status_phase_(phase)
    prometheus.metric.unschedulable_node.metric_list=kube_node_spec_unschedulable
    prometheus.metric.unschedulable_node.apm_metric_path={{ .Values.type }}|Nodes, {{ .Values.type }}|Nodes|(node)
    prometheus.metric.container_status.metric_list=kube_pod_container_status_running, kube_pod_container_status_terminated, kube_pod_container_status_waiting
    prometheus.metric.container_status.apm_metric_path={{ .Values.type }}|Namespaces, {{ .Values.type }}|Namespaces|(namespace)
    prometheus.metric.container_waiting_reason.metric_list=kube_pod_container_status_waiting_reason
    prometheus.metric.container_waiting_reason.apm_metric_path={{ .Values.type }}|Namespaces|(namespace)|kube_pod_container_status_waiting_reason:(reason)
    prometheus.metric.node_allocatable_capacity.metric_list=kube_node_status_allocatable_cpu_cores, kube_node_status_capacity_cpu_cores, kube_node_status_allocatable_memory_bytes , kube_node_status_capacity_memory_bytes, kube_node_status_allocatable_pods, kube_node_status_capacity_pods
    prometheus.metric.node_allocatable_capacity.apm_metric_path={{ .Values.type }}|Nodes, {{ .Values.type }}|Nodes|(node)
    prometheus.metric.daemonset1.metric_list=kube_daemonset_status_number_unavailable, kube_daemonset_status_desired_number_scheduled, kube_daemonset_status_number_available, kube_daemonset_updated_number_scheduled
    prometheus.metric.daemonset1.apm_metric_path={{ .Values.type }}|Namespaces|(namespace), {{ .Values.type }}|Namespaces|(namespace)|kube_daemonset|(daemonset)
    prometheus.metric.daemonset2.metric_list=kube_daemonset_status_number_misscheduled, kube_daemonset_status_current_number_scheduled, kube_daemonset_status_number_ready
    prometheus.metric.daemonset2.apm_metric_path={{ .Values.type }}|Namespaces, {{ .Values.type }}|Namespaces|(namespace), {{ .Values.type }}|Namespaces|(namespace)|kube_daemonset|(daemonset)
    prometheus.metric.deployments1.metric_list=kube_deployment_status_replicas, kube_deployment_status_replicas_available, kube_deployment_status_replicas_unavailable
    prometheus.metric.deployments1.apm_metric_path={{ .Values.type }}|Namespaces, {{ .Values.type }}|Namespaces|(namespace), {{ .Values.type }}|Namespaces|(namespace)|kube_deployment|(deployment)
    prometheus.metric.deployments2.metric_list=kube_deployment_status_replicas_updated, kube_deployment_status_observed_generation, kube_deployment_spec_replicas, kube_deployment_spec_paused
    prometheus.metric.deployments2.apm_metric_path={{ .Values.type }}|Namespaces|(namespace), {{ .Values.type }}|Namespaces|(namespace)|kube_deployment|(deployment)

  haproxy.properties: |
    prometheus.metric.sets:frontend, backend, server
    prometheus.metric.backend.metric_list:haproxy_backend_connections_total, haproxy_backend_current_queue, haproxy_backend_up
    prometheus.metric.backend.apm_metric_path:{{ .Values.type }}|HAProxyRouter|Backends|(backend)
    prometheus.metric.frontend.metric_list:haproxy_frontend_bytes_in_total,haproxy_frontend_max_sessions
    prometheus.metric.frontend.apm_metric_path:{{ .Values.type }}|HAProxyRouter|Frontends|(frontend)
    prometheus.metric.server.metric_list:haproxy_server_bytes_out_total, haproxy_server_check_failures_total, haproxy_server_connection_errors_total, haproxy_server_connections_total, haproxy_server_current_queue, haproxy_server_current_session_rate, haproxy_server_current_sessions, haproxy_server_downtime_seconds_total, haproxy_server_http_average_response_latency_milliseconds, haproxy_server_http_responses_total, haproxy_server_max_session_rate, haproxy_server_up, haproxy_server_response_errors_total
    prometheus.metric.server.apm_metric_path:{{ .Values.type }}|HAProxyRouter|Projects|(namespace)|Services|(service)|Pods|(pod)

  coredns.properties: |
    prometheus.metric.sets=build,cache,counter,request,response,forward,panic
    prometheus.metric.build.metric_list=coredns_build_info
    prometheus.metric.build.apm_metric_path={{ .Values.type }}|Coredns|Build_info|(goversion)|Revision|(revision)|Version|(version)
    prometheus.metric.cache.metric_list=coredns_cache_misses_total
    prometheus.metric.cache.apm_metric_path={{ .Values.type }}|Coredns|Cache|Server|(server)
    prometheus.metric.counter.metric_list=coredns_dns_request_count_total
    prometheus.metric.counter.apm_metric_path={{ .Values.type }}|Coredns|Request|Family|(proto)|Server|(server)|zone-(zone)
    prometheus.metric.request.metric_list=coredns_dns_request_type_count_total
    prometheus.metric.request.apm_metric_path={{ .Values.type }}|Coredns|Request|Server|(server)|Query_type|(type)|Zone-(zone)
    prometheus.metric.response.metric_list=coredns_dns_response_rcode_count_total
    prometheus.metric.response.apm_metric_path={{ .Values.type }}|Coredns|Response|(rcode)|Server|(server)|Zone-(zone)
    prometheus.metric.forward.metric_list=coredns_forward_healthcheck_failure_count_total,coredns_forward_sockets_open
    prometheus.metric.forward.apm_metric_path={{ .Values.type }}|Coredns|Forward|Destination_IP|(to)
    prometheus.metric.panic.metric_list=coredns_panic_count_total
    prometheus.metric.panic.apm_metric_path={{ .Values.type }}|Coredns
    additional.label.sets=set1
    additional.label.set1.source_label=family
    additional.label.set1.target_label=Family

  etcd.properties: |
    prometheus.metric.sets=server,disk,network,debugging,grpc,snapdb,process,mvcc,go
    prometheus.metric.server.metric_list=etcd_server_go_version, etcd_server_has_leader, etcd_server_health_failures, etcd_server_health_success, etcd_server_heartbeat_send_failures_total, etcd_server_id, etcd_server_is_leader,etcd_server_leader_changes_seen_total, etcd_server_proposals_applied_total, etcd_server_proposals_committed_total, etcd_server_proposals_failed_total, etcd_server_proposals_pending, etcd_server_quota_backend_bytes,etcd_server_read_indexes_failed_total, etcd_server_slow_apply_total, etcd_server_slow_read_indexes_total, etcd_server_snapshot_apply_in_progress_total, etcd_server_version
    prometheus.metric.server.apm_metric_path={{ .Values.type }}|etcd|server
    prometheus.metric.disk.metric_list=etcd_disk_backend_commit_duration_seconds, etcd_disk_backend_defrag_duration_seconds, etcd_disk_backend_snapshot_duration_seconds, etcd_disk_wal_fsync_duration_seconds
    prometheus.metric.disk.apm_metric_path={{ .Values.type }}|etcd|disk
    prometheus.metric.network.metric_list=etcd_network_client_grpc_received_bytes_total, etcd_network_client_grpc_sent_bytes_total, etcd_network_peer_received_bytes_total, etcd_network_peer_received_failures_total, etcd_network_peer_round_trip_time_seconds etcd_network_peer_sent_bytes_total, etcd_network_peer_sent_failures_total
    prometheus.metric.network.apm_metric_path={{ .Values.type }}|etcd|network
    prometheus.metric.debugging.metric_list=etcd_debugging_mvcc_compact_revision, etcd_debugging_mvcc_current_revision, etcd_debugging_mvcc_db_compaction_keys_total, etcd_debugging_mvcc_db_compaction_pause_duration_milliseconds, etcd_debugging_mvcc_db_compaction_total_duration_milliseconds, etcd_debugging_mvcc_db_total_size_in_bytes, etcd_debugging_mvcc_delete_total, etcd_debugging_mvcc_events_total, etcd_debugging_mvcc_index_compaction_pause_duration_milliseconds, etcd_debugging_mvcc_keys_total, etcd_debugging_mvcc_pending_events_total, etcd_debugging_mvcc_put_total, etcd_debugging_mvcc_range_total, etcd_debugging_mvcc_slow_watcher_total, etcd_debugging_mvcc_total_put_size_in_bytes, etcd_debugging_mvcc_txn_total, etcd_debugging_mvcc_watch_stream_total, etcd_debugging_mvcc_watcher_total, etcd_debugging_server_lease_expired_total, etcd_debugging_snap_save_marshalling_duration_seconds, etcd_debugging_snap_save_total_duration_seconds, etcd_debugging_store_expires_total, etcd_debugging_store_reads_total, etcd_debugging_store_watch_requests_total, etcd_debugging_store_watchers, etcd_debugging_store_writes_total
    prometheus.metric.debugging.apm_metric_path={{ .Values.type }}|etcd|debugging
    prometheus.metric.grpc.metric_list=etcd_grpc_proxy_cache_hits_total, etcd_grpc_proxy_cache_keys_total, etcd_grpc_proxy_cache_misses_total, etcd_grpc_proxy_events_coalescing_total, etcd_grpc_proxy_watchers_coalescing_total
    prometheus.metric.grpc.apm_metric_path={{ .Values.type }}|etcd|grpc
    prometheus.metric.snapdb.metric_list=etcd_snap_db_save_total_duration_seconds,etcd_snap_db_fsync_duration_seconds
    prometheus.metric.snapdb.apm_metric_path={{ .Values.type }}|etcd|snapshot
    prometheus.metric.process.metric_list=process_open_fds, process_max_fds, process_cpu_seconds_total, process_resident_memory_bytes, process_start_time_seconds, process_virtual_memory_bytes
    prometheus.metric.process.apm_metric_path={{ .Values.type }}|etcd|process
    prometheus.metric.mvcc.metric_list=etcd_mvcc_db_total_size_in_bytes, etcd_mvcc_db_total_size_in_use_in_bytes, etcd_mvcc_hash_duration_seconds, etcd_mvcc_hash_rev_duration_seconds
    prometheus.metric.mvcc.apm_metric_path={{ .Values.type }}|etcd|mvcc
    
  apiserver.properties: |
    prometheus.metric.sets=apiserver,watchers,root,apiservices,etcd,threads,memory,process,clients,workqueue,etcdobj,lable4,lable5
    prometheus.metric.apiserver.metric_list=apiserver_response_sizes,apiserver_response_sizes_sum,apiserver_response_sizes_count,apiserver_request_count,apiserver_longrunning_gauge,apiserver_request_duration_seconds,apiserver_request_duration_seconds_sum,apiserver_request_duration_seconds_count,apiserver_request_latencies,apiserver_request_latencies_sum,apiserver_request_latencies_count,apiserver_request_total
    prometheus.metric.apiserver.apm_metric_path={{ .Values.type }}|apiserver|(scope)|(resource)|(verb)
    prometheus.metric.apiserver.apm_metric_type=LongFluctuating
    prometheus.metric.apiserver.aggregation_type=sum
    prometheus.metric.watchers.metric_list=apiserver_registered_watchers,apiserver_watch_events_sizes,apiserver_watch_events_sizes_sum,apiserver_watch_events_sizes_count,apiserver_watch_events_total,apiserver_registered_watchers,apiserver_watch_events_total
    prometheus.metric.watchers.apm_metric_path={{ .Values.type }}|apiserver|kinds|(kind)
    prometheus.metric.watchers.apm_metric_type=LongFluctuating
    prometheus.metric.watchers.aggregation_type=sum
    prometheus.metric.root.metric_list=APIServiceOpenAPIAggregationControllerQueue1_adds,APIServiceOpenAPIAggregationControllerQueue1_depth, APIServiceOpenAPIAggregationControllerQueue1_queue_latency, APIServiceOpenAPIAggregationControllerQueue1_retries,APIServiceOpenAPIAggregationControllerQueue1_work_duration,APIServiceRegistrationController_adds, APIServiceRegistrationController_depth, APIServiceRegistrationController_queue_latency,APIServiceRegistrationController_work_duration,AvailableConditionController_adds,AvailableConditionController_depth,AvailableConditionController_retries,AvailableConditionController_queue_latency,AvailableConditionController_work_duration,DiscoveryController_adds,DiscoveryController_work_duration,admission_quota_controller_work_duration,admission_quota_controller_queue_latency,apiserver_current_inflight_requests,apiserver_request_duration_seconds,apiserver_request_duration_seconds_sum,apiserver_request_duration_seconds_count
    prometheus.metric.root.apm_metric_path={{ .Values.type }}|apiserver
    prometheus.metric.root.apm_metric_type=LongFluctuating
    prometheus.metric.root.aggregation_type=sum
    prometheus.metric.apiservices.metric_list=apiserver_storage_data_key_generation_failures_total,apiserver_storage_envelope_transformation_cache_misses_total,apiserver_watch_events_sizes,apiserver_watch_events_sizes_sum,apiserver_watch_events_sizes_count
    prometheus.metric.apiservices.apm_metric_path={{ .Values.type }}|apiserver|apiservices
    prometheus.metric.apiservices.apm_metric_type=LongFluctuating
    prometheus.metric.apiservices.aggregation_type=sum
    prometheus.metric.etcd.metric_list=etcd_request_duration_seconds,etcd_request_duration_seconds_sum,etcd_request_duration_seconds_count
    prometheus.metric.etcd.apm_metric_path={{ .Values.type }}|etcd
    prometheus.metric.etcd.apm_metric_type=LongFluctuating
    prometheus.metric.etcd.aggregation_type=sum
    prometheus.metric.threads.metric_list=go_goroutines,go_threads
    prometheus.metric.threads.apm_metric_path={{ .Values.type }}|apiserver|threads
    prometheus.metric.memory.metric_list=go_gc_duration_seconds,go_gc_duration_seconds_sum,go_gc_duration_seconds_count,go_memstats_alloc_bytes,go_memstats_frees_total,go_memstats_heap_alloc_bytes,go_memstats_heap_idle_bytes,go_memstats_heap_inuse_bytes,go_memstats_heap_objects,go_memstats_alloc_bytes_total
    prometheus.metric.memory.apm_metric_path={{ .Values.type }}|apiserver|memory
    prometheus.metric.process.metric_list=process_virtual_memory_bytes,process_resident_memory_bytes,process_max_fds,process_open_fds
    prometheus.metric.process.apm_metric_path={{ .Values.type }}|apiserver|process
    prometheus.metric.clients.metric_list=grpc_client_handled_total,rest_client_request_duration_seconds,rest_client_request_duration_seconds_sum,rest_client_request_duration_seconds_count,rest_client_requests_total,rest_client_requests_total_sum,rest_client_requests_total_count
    prometheus.metric.clients.apm_metric_path={{ .Values.type }}|apiserver|clients
    prometheus.metric.workqueue.metric_list=autoregister_adds,autoregister_depth,autoregister_queue_latency,autoregister_retries,autoregister_work_duration,controller_clusterquotamappingcontroller_clusterquotas_adds,controller_clusterquotamappingcontroller_clusterquotas_depth,controller_clusterquotamappingcontroller_clusterquotas_queue_latency,controller_clusterquotamappingcontroller_clusterquotas_retries,controller_clusterquotamappingcontroller_clusterquotas_work_duration,controller_clusterquotamappingcontroller_namespaces_adds,controller_clusterquotamappingcontroller_namespaces_depth,controller_clusterquotamappingcontroller_namespaces_queue_latency,controller_clusterquotamappingcontroller_namespaces_retries,controller_clusterquotamappingcontroller_namespaces_work_duration,crdEstablishing_adds,crdEstablishing_depth,crdEstablishing_queue_latency,crdEstablishing_retries,workqueue_queue_duration_seconds,workqueue_queue_duration_seconds_sum,workqueue_queue_duration_seconds_count,workqueue_work_duration_seconds,workqueue_work_duration_seconds_sum,workqueue_work_duration_seconds_count
    prometheus.metric.workqueue.apm_metric_path={{ .Values.type }}|apiserver|workqueue
    prometheus.metric.workqueue.apm_metric_type=LongFluctuating
    prometheus.metric.workqueue.aggregation_type=sum
    prometheus.metric.lable4.metric_list=workqueue_adds_total,workqueue_depth,workqueue_longest_running_processor_seconds,workqueue_retries_total,workqueue_queue_duration_seconds_bucket,workqueue_unfinished_work_seconds
    prometheus.metric.lable4.apm_metric_path={{ .Values.type }}|apiserver|workqueue|(name)
    prometheus.metric.etcdobj.metric_list=etcd_object_counts
    prometheus.metric.etcdobj.apm_metric_path={{ .Values.type }}|etcd|(resource)
    prometheus.metric.etcdobj.apm_metric_type=LongFluctuating
    prometheus.metric.etcdobj.aggregation_type=sum
    prometheus.metric.lable5.metric_list=grpc_client_handled_total,grpc_client_msg_sent_total,grpc_client_msg_received_total,grpc_client_started_total
    prometheus.metric.lable5.apm_metric_path={{ .Values.type }}|apiserver|clients|grpc|method|(grpc_method)|service|grpc_service|type|(grpc_type)


{{end}}
